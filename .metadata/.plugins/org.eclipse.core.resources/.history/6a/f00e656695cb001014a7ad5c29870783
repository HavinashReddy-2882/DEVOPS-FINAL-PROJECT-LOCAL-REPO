package com.klef.fsd.sdp.hotelhub.controller;

import com.klef.fsd.sdp.hotelhub.model.*;
import com.klef.fsd.sdp.hotelhub.service.ManagerServiceImpl; // Import IMPL
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import java.util.List;

@RestController @RequestMapping("/manager") @CrossOrigin("*")
public class ManagerController {
    @Autowired private ManagerServiceImpl managerService; // Change type to Impl

    @PostMapping("/checkmanagerlogin") public ResponseEntity<?> login(@RequestBody Manager m) {
        Manager res = managerService.checkManagerLogin(m.getUsername(), m.getPassword());
        return res != null ? ResponseEntity.ok(res) : ResponseEntity.status(401).body("Invalid");
    }

    // Room
    @PostMapping("/addroom") public String addRoom(@RequestBody Room r) { return managerService.addRoom(r); }
    @PostMapping("/updateroom") public String updateRoom(@RequestBody Room r) { return managerService.updateRoom(r); }
    @DeleteMapping("/deleteroom/{id}") public String deleteRoom(@PathVariable int id) { return managerService.deleteRoom(id); }
    @GetMapping("/viewmyrooms/{id}") public List<Room> viewRooms(@PathVariable int id) { return managerService.viewAllRoomsByManager(id); }
    @GetMapping("/viewbookings/{id}") public List<Booking> viewBookings(@PathVariable int id) { return managerService.viewBookingsForManager(id); }

    // Food
    @PostMapping("/addfood") public String addFood(@RequestBody FoodItem f) { managerService.addFoodItem(f); return "Added"; }
    @GetMapping("/viewfood/{id}") public List<FoodItem> viewFood(@PathVariable int id) { return managerService.viewFoodMenu(id); }
    @DeleteMapping("/deletefood/{id}") public String deleteFood(@PathVariable int id) { managerService.deleteFoodItem(id); return "Deleted"; }

    // Cab Management
    @PostMapping("/addcab") public String addCab(@RequestBody Cab c) { managerService.addCab(c); return "Added"; }
    @GetMapping("/viewcabs/{id}") public List<Cab> viewCabs(@PathVariable int id) { return managerService.viewMyCabs(id); }
    @DeleteMapping("/deletecab/{id}") public String deleteCab(@PathVariable int id) { managerService.deleteCab(id); return "Deleted"; }

    // ðŸ‘‡ NEW: Cab Request Management Endpoints
    @GetMapping("/cabrequests/{id}")
    public List<CabBooking> viewRequests(@PathVariable int id) {
        return managerService.viewCabRequests(id);
    }

    @GetMapping("/updatecabstatus/{id}/{status}")
    public String updateCabStatus(@PathVariable int id, @PathVariable String status) {
        return managerService.updateCabStatus(id, status);
    }
}