package com.klef.fsd.sdp.hotelhub.service;

import com.klef.fsd.sdp.hotelhub.model.*;
import com.klef.fsd.sdp.hotelhub.repository.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.util.List;

@Service
public class CustomerServiceImpl implements CustomerService {

    @Autowired private CustomerRepository customerRepository;
    @Autowired private BookingRepository bookingRepository;
    @Autowired private RoomRepository roomRepository;
    @Autowired private FoodItemRepository foodItemRepository; // New
    @Autowired private CabRepository cabRepository; // New

    @Override public Customer checkCustomerLogin(String u, String p) { return customerRepository.findByUsernameAndPassword(u, p); }
    @Override public Customer registerCustomer(Customer c) { return customerRepository.save(c); }
    
    @Override @Transactional public Booking bookRoom(Booking booking) {
        Booking saved = bookingRepository.save(booking);
        if(saved.getRoom() != null) roomRepository.updateRoomAvailability(false, saved.getRoom().getId());
        return saved;
    }
    
    @Override public Booking updateBooking(Booking booking) { return bookingRepository.save(booking); }
    @Override public List<Booking> viewMyBookings(int cid) { return bookingRepository.findByCustomerId(cid); }
    @Override public List<Room> viewAllAvailableRooms() { return roomRepository.findByAvailableTrue(); }
    
    @Override @Transactional public Customer updateProfile(Customer c) {
        Customer existing = customerRepository.findById(c.getId()).orElse(null);
        if (existing != null) {
            existing.setName(c.getName()); existing.setDob(c.getDob());
            existing.setAddress(c.getAddress()); existing.setContact(c.getContact());
            return customerRepository.save(existing);
        }
        return null;
    }

    // New Features Implementation
    public List<FoodItem> viewAllFoodItems() { return foodItemRepository.findAll(); }
    public List<Cab> viewAvailableCabs() { return cabRepository.findByAvailableTrue(); }
}